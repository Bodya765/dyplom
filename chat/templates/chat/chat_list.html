{% extends 'base.html' %}
{% load static %}

{% block title %}Мої чати{% endblock %}

{% block content %}
<div class="chat-list-page">
    <h1 class="page-title">Мої чати</h1>

    <!-- Кнопки для перемикання -->
    <div class="chat-tabs">
        <button class="tab-button active" data-tab="buying">
            <span class="tab-icon"><i class="fas fa-shopping-cart"></i></span> Купую
        </button>
        <button class="tab-button" data-tab="selling">
            <span class="tab-icon"><i class="fas fa-store"></i></span> Продаю
        </button>
    </div>

    <!-- Контейнер для списків чатів -->
    <div class="chat-content">
        <!-- Розділ "Купую" -->
        <div class="chat-tab active" id="buying">
            <div class="chat-list">
                {% for chat in user_chats %}
                    {% if chat.buyer == request.user %}
                        <a href="{% url 'chat:chat_detail' chat.id %}" class="chat-item">
                            <div class="chat-item-avatar">
                                <img src="{% if chat.seller.profile.avatar %}{{ chat.seller.profile.avatar.url }}{% else %}{% static 'images/default_avatar.png' %}{% endif %}" alt="Avatar">
                            </div>
                            <div class="chat-item-info">
                                <span class="chat-item-name">{{ chat.seller.username }}</span>
                                <span class="chat-item-status" data-status="{% if chat.seller.status.is_online %}online{% else %}offline{% endif %}">
                                    <span class="status-dot"></span>
                                    {% if chat.seller.status.is_online %}
                                        Онлайн
                                    {% else %}
                                        Офлайн
                                    {% endif %}
                                </span>
                            </div>
                        </a>
                    {% endif %}
                {% empty %}
                    <p class="empty-message">У вас ще немає чатів як покупця.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Розділ "Продаю" -->
        <div class="chat-tab" id="selling">
            <div class="chat-list">
                {% for chat in user_chats %}
                    {% if chat.seller == request.user %}
                        <a href="{% url 'chat:chat_detail' chat.id %}" class="chat-item">
                            <div class="chat-item-avatar">
                                <img src="{% if chat.buyer.profile.avatar %}{{ chat.buyer.profile.avatar.url }}{% else %}{% static 'images/default_avatar.png' %}{% endif %}" alt="Avatar">
                            </div>
                            <div class="chat-item-info">
                                <span class="chat-item-name">{{ chat.buyer.username }}</span>
                                <span class="chat-item-status" data-status="{% if chat.buyer.status.is_online %}online{% else %}offline{% endif %}">
                                    <span class="status-dot"></span>
                                    {% if chat.buyer.status.is_online %}
                                        Онлайн
                                    {% else %}
                                        Офлайн
                                    {% endif %}
                                </span>
                            </div>
                        </a>
                    {% endif %}
                {% empty %}
                    <p class="empty-message">У вас ще немає чатів як продавця.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.chat-tab');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Видаляємо клас active з усіх кнопок і вкладок
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Додаємо клас active до натиснутої кнопки та відповідної вкладки
                button.classList.add('active');
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
    });
</script>
{% endblock %}